name: Build container release images
# 비활성화됨: 포크 저장소에서는 원본 마스토돈의 Docker Hub/Container Registry에 푸시할 권한이 없음
# on:
#   push:
#     tags:
#       - '*'
on:
  push:
    tags:
      - 'never-match-this-tag-*'  # 비활성화

permissions:
  contents: read
  packages: write

jobs:
  build-image:
    if: false  # 워크플로우 비활성화
    uses: ./.github/workflows/build-container-image.yml
    with:
      platforms: linux/amd64,linux/arm64
      use_native_arm64_builder: true
      push_to_images: |
        tootsuite/mastodon
        ghcr.io/mastodon/mastodon
      # Do not use cache when building releases, so apt update is always ran and the release always contain the latest packages
      cache: false
      # Only tag with latest when ran against the latest stable branch
      # This needs to be updated after each minor version release
      flavor: |
        latest=${{ startsWith(github.ref, 'refs/tags/v4.2.') }}
      tags: |
        type=pep440,pattern={{raw}}
        type=pep440,pattern=v{{major}}.{{minor}}
    secrets: inherit
